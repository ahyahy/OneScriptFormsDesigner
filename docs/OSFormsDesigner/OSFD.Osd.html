<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>Сохранение в osd</TITLE>
<META content="text/html; charset=Windows-1252" http-equiv="Content-Type">
<LINK rel="stylesheet" type="text/css" href="mainstyle.css"></HEAD>
<BODY id=bodyID class=dtBODY>
<DIV id=nsbanner>
<DIV id=bannerrow1>
<TABLE class=bannerparthead cellSpacing=0>
  <TBODY>
  <TR id=hdr>
    <TD class=runninghead></TD>
    <TD class=product></TD></TR></TBODY></TABLE></DIV>
<DIV id=TitleRow>
<H1 class=dtH1>Сохранение формы в файл osd</H1></DIV></DIV>
<DIV id=nstext>
<P>Как и любая программа дизайнер должен иметь возможность сохранения наработанного материала и его последующего восстановления, для 
продолжения работы. Удобнее сохранять в файл с определенным синтаксисом. Синтаксис должен быть интуитивно понятным, коротким, шифрование пока не требуется. После 
рассмотрения различных вариантов остановился на формате <B>"ini"</B> файлов. Немного переиначил его для удобства заполнения/считывания/разбора и назвал форматом <B>"osd"</B>.</P>
<P>Алгоритм выгрузки находится в классе <B>SaveForm.cs</B>, загрузки - в <B>pDesignerMainForm.cs</B> и в <B>PropValueConverter.cs</B>.</P>
<P>При выгрузке заполняется шаблон, имеющий условно два раздела. Больше не потребовалось. Разделы заключены в конструкции:</P>
<PRE class="code">
[<Конструкторы]
[Конструкторы>]
[<Свойства]
[Свойства>]
</PRE>
<P>Такой шаблон удобно заполнять добавляя строки со свойствами или выше ограничителя <B>[Свойства>]</B>, или ниже ограничителя <B>[<Свойства]</B>. То же самое и с 
самими компонентами, дописываем между ограничителями <B>[<Конструкторы]</B> и <B>[Конструкторы>]</B>.</P>
<P>Частично использовался уже наработанный алгоритм формирования сценария (класс <B>SaveScript.cs</B>), поэтому в <B>"osd"</B> можно увидеть подобные строки:</P>
<PRE class="code">
[<Конструкторы]
Форма_0 = Ф.Форма();
ПанельВкладок1 = Ф.ПанельВкладок();
...
[Конструкторы>]
[<Свойства]
[<Форма_0]
Форма_0.Размер = Ф.Размер(440, 415);
...
[Свойства>]
</PRE>
<P>Итак, у нас есть формат файла для сохранения, нужно его заполнить по алгоритму:</P>
<li>1. Получить перечень текущих свойств формы и всех компонентов.</li>
<li>2. Выгрузить обязательные свойства согласно свойству <B>RequiredValues</B> в классе компонента.</li>
<li>3. Сравнить текущие свойства с <B>DefaultValues</B> в классе компонента и измененные выгрузить.</li>
<P>Перечень текущих свойств формы и всех компонентов получаем из сетки свойств и коллекции компонентов. <B>RequiredValues</B> и <B>DefaultValues</B> - это 
свойства у каждого компонента с типом значения <B>String</B>. Свойства, перечисленные в <B>RequiredValues</B> выгружаются независимо от того были или нет изменены в процессе 
работы. <B>DefaultValues</B> - содержит перечень свойств, которые были у компонента на момент создания или после загрузки из <B>"osd"</B>. <B>DefaultValues</B> заполняется 
динамически, изначально оно пустое.</P>
<P>.</P>
</DIV></BODY></HTML>